<!DOCTYPE html>

<html lang="es" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>viajes &#8212; documentación de VieraFernandez2324 - v.0.0.1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css?v=514cf933" />
    
    <script src="../_static/documentation_options.js?v=8ee129b9"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=efdbd0b9"></script>
    
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Índice de Módulos Python"
             >módulos</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">documentación de VieraFernandez2324 - v.0.0.1</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Código de módulo</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">viajes</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Código fuente para viajes</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">PyQt6.QtWidgets</span> <span class="kn">import</span> <span class="n">QComboBox</span>

<span class="kn">import</span> <span class="nn">conexion</span>
<span class="kn">import</span> <span class="nn">facturas</span>
<span class="kn">from</span> <span class="nn">windowaux</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt6</span> <span class="kn">import</span> <span class="n">QtWidgets</span><span class="p">,</span> <span class="n">QtSql</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtCore</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">drivers</span>
<span class="kn">import</span> <span class="nn">eventos</span>
<span class="kn">import</span> <span class="nn">var</span>


<div class="viewcode-block" id="Viajes">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes">[documentos]</a>
<span class="k">class</span> <span class="nc">Viajes</span><span class="p">():</span>

<div class="viewcode-block" id="Viajes.limpiarPanelViaje">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.limpiarPanelViaje">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">limpiarPanelViaje</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Limpia el texto de los diferentes widgets en el módulo.</span>

<span class="sd">        :param self: Instancia del módulo.</span>
<span class="sd">        :type self: Viajes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listawidgets</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbOrigenProvFac</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbOrigenLocFac</span><span class="p">,</span>
                          <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbDestinoProvFac</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbDestinoLocFac</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txt_kms</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lbl_idViaje</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">listawidgets</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;setText&#39;</span><span class="p">):</span>
                    <span class="n">i</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">):</span>  <span class="c1"># borrar combobox</span>
                    <span class="n">i</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>



        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error limpiando panel de viajes&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>




<span class="w">    </span><span class="sd">&quot;&quot;&quot;ZONA CONEXION&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Viajes.selMuniviajeorigen">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.selMuniviajeorigen">[documentos]</a>
    <span class="k">def</span> <span class="nf">selMuniviajeorigen</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Actualiza la lista de municipios en el combo box de origen basándose en la provincia seleccionada.</span>

<span class="sd">        :param self: Instancia de la clase (puede ser None si se llama de manera estática).</span>
<span class="sd">        :type self: Viajes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbOrigenLocFac</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">prov</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbOrigenProvFac</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>  <span class="c1">#</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>

            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s1">&#39;select idprov from provincias where provincia = :prov&#39;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:prov&#39;</span><span class="p">,</span> <span class="n">prov</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>  <span class="c1"># LLENAR LAS PROVINCIAS MIENTRAS HAYA</span>
                    <span class="nb">id</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">query1</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query1</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s1">&#39;select municipio from municipios where idprov = :id&#39;</span><span class="p">)</span>
            <span class="n">query1</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:id&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query1</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbOrigenLocFac</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">query1</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbOrigenLocFac</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">query1</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error seleccion municipios  en origen&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="Viajes.selMuniviajedestino">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.selMuniviajedestino">[documentos]</a>
    <span class="k">def</span> <span class="nf">selMuniviajedestino</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Actualiza la lista de municipios en el combo box de origen basándose en la provincia seleccionada.</span>

<span class="sd">                :param self: Instancia de la clase</span>
<span class="sd">                :type self: Viajes</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbDestinoLocFac</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">prov</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbDestinoProvFac</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>  <span class="c1">#</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>

            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s1">&#39;select idprov from provincias where provincia = :prov&#39;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:prov&#39;</span><span class="p">,</span> <span class="n">prov</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>  <span class="c1"># LLENAR LAS PROVINCIAS MIENTRAS HAYA</span>
                    <span class="nb">id</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">query1</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query1</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s1">&#39;select municipio from municipios where idprov = :id&#39;</span><span class="p">)</span>
            <span class="n">query1</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:id&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query1</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbDestinoLocFac</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">query1</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbDestinoLocFac</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">query1</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error seleccion municipios en destino &quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="Viajes.datosViaje">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.datosViaje">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">datosViaje</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: Módulo que devuelve registro de un viaje</span>
<span class="sd">        :rtype: bytearray</span>

<span class="sd">        Este módulo carga los datos de los widgets del panel de gestión,</span>
<span class="sd">        selecciona la tarifa en funcion del tipo de viaje y devuelve</span>
<span class="sd">        un array con los datos</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># var.ui.txt_kms.setText(&quot;&quot;)  # Comentario: ¿Estás seguro de querer comentar esta línea?</span>

            <span class="n">tarifas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]</span>
            <span class="n">datosViaje</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbOrigenProvFac</span><span class="o">.</span><span class="n">currentText</span><span class="p">(),</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbOrigenLocFac</span><span class="o">.</span><span class="n">currentText</span><span class="p">(),</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbDestinoProvFac</span><span class="o">.</span><span class="n">currentText</span><span class="p">(),</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbDestinoLocFac</span><span class="o">.</span><span class="n">currentText</span><span class="p">(),</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txt_kms</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">datosViaje</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">datosViaje</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">datosViaje</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">datosViaje</span><span class="p">[</span><span class="mi">3</span><span class="p">]):</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">rbtLocal</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txt_kms</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;10&quot;</span><span class="p">)</span>
                <span class="n">datosViaje</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tarifas</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

            <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">datosViaje</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">datosViaje</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txt_kms</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">rbtProvincial</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">datosViaje</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tarifas</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txt_kms</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">rbtNacional</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">datosViaje</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tarifas</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

            <span class="k">return</span> <span class="n">datosViaje</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error datos viajes&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="Viajes.cargarLineaVenta">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.cargarLineaVenta">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">cargarLineaVenta</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Método para cargar una línea de venta.</span>

<span class="sd">        Parámetros:</span>
<span class="sd">            - Ninguno directamente. Utiliza los datos del viaje y el número de factura desde la interfaz gráfica.</span>

<span class="sd">        Acciones:</span>
<span class="sd">            - Obtiene los datos del viaje utilizando el método datosViaje de la clase Viajes.</span>
<span class="sd">            - Obtiene el número de factura desde la interfaz gráfica.</span>
<span class="sd">            - Si el valor del índice 5 de los datos del viaje es igual a 0.8, establece la variable km a 10.</span>
<span class="sd">              En caso contrario, obtiene el valor de los kilómetros desde la interfaz gráfica.</span>
<span class="sd">            - Agrega el número de factura y la variable km a la lista de datos del viaje.</span>
<span class="sd">            - Llama al método cargarLineaViaje de la clase Viajes para realizar la conexión con la base de datos.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>


            <span class="n">viaje</span> <span class="o">=</span> <span class="n">Viajes</span><span class="o">.</span><span class="n">datosViaje</span><span class="p">()</span>
            <span class="n">factura</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lblNumFac</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">viaje</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">factura</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DATOS DE DATOS VIAJES &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">viaje</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">viaje</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="mf">0.8</span><span class="p">):</span>
                <span class="n">km</span> <span class="o">=</span> <span class="mi">10</span>
                <span class="n">viaje</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">km</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">Viajes</span><span class="o">.</span><span class="n">cargarLineaViaje</span><span class="p">(</span><span class="n">viaje</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en cargarLineaVenta:&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>




<div class="viewcode-block" id="Viajes.cargarLineaViaje">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.cargarLineaViaje">[documentos]</a>
    <span class="k">def</span> <span class="nf">cargarLineaViaje</span><span class="p">(</span><span class="n">registro</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Método para cargar un registro de viaje en la base de datos.</span>

<span class="sd">        Parámetros:</span>
<span class="sd">            - registro: Lista que contiene los datos del viaje a ser almacenados en la base de datos.</span>
<span class="sd">                        Debe contener los siguientes elementos en este orden: factura, origen, destino, tarifa, km.</span>

<span class="sd">        Acciones:</span>
<span class="sd">            - Imprime por pantalla el registro recibido.</span>
<span class="sd">            - Verifica si algún elemento en el registro está vacío o compuesto solo por espacios en blanco.</span>
<span class="sd">              Si es así, muestra un mensaje de advertencia indicando que faltan datos del viaje o número de factura.</span>
<span class="sd">            - Si todos los elementos del registro tienen datos válidos, prepara una consulta SQL para insertar el viaje en la base de datos.</span>
<span class="sd">            - Ejecuta la consulta y muestra un mensaje de éxito o error según el resultado.</span>
<span class="sd">            - Si la inserción es exitosa, actualiza la tabla de viajes llamando al método cargarTablaViajes de la clase Viajes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Registro en cargar linea viaje :&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">))</span><span class="c1">##IMPRIMIR POR PANTALLA EL REGISTRO QUE ME LLEGA</span>


            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">elemento</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">elemento</span> <span class="ow">in</span> <span class="n">registro</span><span class="p">):</span>
                <span class="n">mbox</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;AVISO&#39;</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Icon</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Faltan datos del viaje o numero factura&#39;</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>



                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s1">&#39;insert into viajes(factura, origen, destino, tarifa, km)&#39;</span>
                              <span class="s1">&#39;VALUES (:factura, :origen, :destino, :tarifa, :km)&#39;</span><span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:factura&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:origen&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:destino&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:tarifa&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:km&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>

                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="n">mbox</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
                    <span class="n">mbox</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;GUARDADO&#39;</span><span class="p">)</span>
                    <span class="n">mbox</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Icon</span><span class="o">.</span><span class="n">Information</span><span class="p">)</span>
                    <span class="n">mbox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Viaje grabado en la base de datos&#39;</span><span class="p">)</span>
                    <span class="n">mbox</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
                    <span class="n">Viajes</span><span class="o">.</span><span class="n">cargarTablaViajes</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                    <span class="n">conexion</span><span class="o">.</span><span class="n">Conexion</span><span class="o">.</span><span class="n">cargarFacturas</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                    <span class="n">Viajes</span><span class="o">.</span><span class="n">limpiarPanelViaje</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mbox</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
                    <span class="n">mbox</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;:(&#39;</span><span class="p">)</span>
                    <span class="n">mbox</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Icon</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
                    <span class="n">mbox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Error al grabar el viaje en la base de datos&#39;</span><span class="p">)</span>
                    <span class="n">mbox</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>


        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error cargar linea viaje&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>



<div class="viewcode-block" id="Viajes.cargarTablaViajes">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.cargarTablaViajes">[documentos]</a>
    <span class="k">def</span> <span class="nf">cargarTablaViajes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Método para cargar los datos de viajes en la tabla de la interfaz gráfica.</span>

<span class="sd">        Parámetros:</span>
<span class="sd">            - Ninguno directamente. Utiliza el número de factura desde la interfaz gráfica.</span>

<span class="sd">        Acciones:</span>
<span class="sd">            - Obtiene los datos de viajes asociados al número de factura desde la clase Viajes.</span>
<span class="sd">            - Itera sobre los registros obtenidos y los muestra en la tabla de viajes de la interfaz gráfica.</span>
<span class="sd">            - Calcula el total para cada registro y lo muestra en la columna correspondiente.</span>
<span class="sd">            - Alinea el texto en las celdas de la tabla y agrega un botón de eliminación para cada registro.</span>
<span class="sd">            - Calcula el subtotal, el IVA y el total de los viajes y los muestra en etiquetas correspondientes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">actionlimpiarPanel</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">Viajes</span><span class="o">.</span><span class="n">limpiarPanelViaje</span><span class="p">)</span>
            <span class="n">datos</span> <span class="o">=</span> <span class="n">Viajes</span><span class="o">.</span><span class="n">viajesFactura</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lblNumFac</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">subtotal</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="c1"># Verificar si hay datos antes de realizar acciones en la tabla</span>
            <span class="k">if</span> <span class="n">datos</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">registro</span> <span class="ow">in</span> <span class="n">datos</span><span class="p">:</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># crea una fila</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">3</span><span class="p">])))</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">4</span><span class="p">])))</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">5</span><span class="p">])))</span>

                    <span class="n">valor_pos4</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                    <span class="n">valor_pos5</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">registro</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                    <span class="n">total</span> <span class="o">=</span> <span class="n">valor_pos4</span> <span class="o">*</span> <span class="n">valor_pos5</span>
                    <span class="n">total_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">total_str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; €&#39;</span><span class="p">))</span>

                    <span class="c1"># Alinear el texto en las celdas de la tabla</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                        <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">setTextAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>

                    <span class="n">btn_borrar</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">()</span>
                    <span class="n">btn_borrar</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
                    <span class="n">btn_borrar</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s1">&#39;./img/basura.png&#39;</span><span class="p">))</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span>
                                                                             <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeMode</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>

                    <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span><span class="o">.</span><span class="n">setColumnWidth</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">btn_borrar</span><span class="p">)</span>
                    <span class="n">btn_borrar</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">Viajes</span><span class="o">.</span><span class="n">borrarviaje</span><span class="p">)</span>
                    <span class="c1"># Sumar el subtotal</span>
                    <span class="n">subtotal</span> <span class="o">+=</span> <span class="n">total</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">iva_porc</span> <span class="o">=</span> <span class="mf">0.21</span>
                <span class="n">iva</span> <span class="o">=</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="n">iva_porc</span>
                <span class="n">total_iva</span> <span class="o">=</span> <span class="n">subtotal</span> <span class="o">+</span> <span class="n">iva</span>
                <span class="c1"># Asignar el subtotal al QLabel después del bucle</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lbl_subTotal</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subtotal</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; </span><span class="se">\u20AC</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lbl_iva</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">iva</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; </span><span class="se">\u20AC</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lbl_total</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_iva</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; </span><span class="se">\u20AC</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Si no hay datos de viajes, limpiar la tabla y actualizar las etiquetas a cero</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lbl_subTotal</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;0.00 </span><span class="se">\u20AC</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lbl_iva</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;0.00 </span><span class="se">\u20AC</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lbl_total</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;0.00 </span><span class="se">\u20AC</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error cargar TABLA VIAJES&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="Viajes.limpiarTablaViajes">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.limpiarTablaViajes">[documentos]</a>
    <span class="k">def</span> <span class="nf">limpiarTablaViajes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Método para limpiar la tabla de viajes en la interfaz gráfica.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Elimina todas las filas de la tabla</span>
        <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lbl_subTotal</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;0.00 </span><span class="se">\u20AC</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lbl_iva</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;0.00 </span><span class="se">\u20AC</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lbl_total</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;0.00 </span><span class="se">\u20AC</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Viajes.viajesFactura">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.viajesFactura">[documentos]</a>
    <span class="k">def</span> <span class="nf">viajesFactura</span><span class="p">(</span><span class="n">dato</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Método para obtener información sobre los viajes asociados a un número de factura.</span>

<span class="sd">        :return: - Una lista de listas, donde cada lista representa un registro de viaje.</span>
<span class="sd">                   Cada registro contiene los datos de un viaje almacenados en la base de datos.</span>
<span class="sd">        :rtype: - dato: Número de factura del cual se desea obtener información</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">valores</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;select * from viajes where factura = :dato&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:dato&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dato</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>  <span class="c1"># funcion lambda</span>
                    <span class="n">valores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="c1">#print(&quot;Valores de viajesfactura22222: &quot;+str(valores))</span>
            <span class="k">return</span> <span class="n">valores</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR CARGAR viaje a la vista&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>





<div class="viewcode-block" id="Viajes.cargaViaje">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.cargaViaje">[documentos]</a>
    <span class="k">def</span> <span class="nf">cargaViaje</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Método para cargar los datos de un viaje al hacer clic en una fila de la tabla de viajes.</span>

<span class="sd">        Acciones:</span>
<span class="sd">            - Limpia el panel de información de viaje llamando al método limpiarPanelViaje.</span>
<span class="sd">            - Obtiene la fila seleccionada en la tabla de viajes.</span>
<span class="sd">            - Llama al método cargarDatosViaje para mostrar los datos en los ComboBox correspondientes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Viajes</span><span class="o">.</span><span class="n">limpiarPanelViaje</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="n">row</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()</span>
            <span class="n">fila</span> <span class="o">=</span> <span class="p">[</span><span class="n">dato</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="k">for</span> <span class="n">dato</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span>


            <span class="n">Viajes</span><span class="o">.</span><span class="n">cargarDatosViaje</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al cargar los datos DE UN VIAJE EN CARGAVIAJE &quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


    <span class="c1">##METODO para recoger todos los datos de un viaje</span>

<div class="viewcode-block" id="Viajes.oneViaje">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.oneViaje">[documentos]</a>
    <span class="k">def</span> <span class="nf">oneViaje</span><span class="p">(</span><span class="n">codigo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Método para obtener información de un viaje específico identificado por su código.</span>

<span class="sd">        :param codigo: Código del viaje del cual se desea obtener información.</span>
<span class="sd">        :return: Una lista que contiene los datos del viaje: [idviajes, factura, origen, destino, tarifa, km].</span>
<span class="sd">        :rtype: list</span>

<span class="sd">        Acciones:</span>
<span class="sd">            - Crea una lista vacía llamada &#39;registro&#39; para almacenar los datos del viaje.</span>
<span class="sd">            - Prepara una consulta SQL para seleccionar los campos específicos de la tabla &#39;viajes&#39;</span>
<span class="sd">              donde el ID del viaje sea igual al código proporcionado.</span>
<span class="sd">            - Ejecuta la consulta y, si tiene éxito, obtiene los datos del primer registro y los agrega a la lista &#39;registro&#39;.</span>
<span class="sd">            - Retorna la lista &#39;registro&#39; que contiene la información del viaje.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">registro</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT idviajes, factura, origen, destino, tarifa, km  FROM viajes WHERE idviajes = :numfac&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:numfac&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">codigo</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                        <span class="n">registro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>


            <span class="k">return</span> <span class="n">registro</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error en fichero conexion datos de UN VIAJE: &quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="Viajes.cargarDatosViaje">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.cargarDatosViaje">[documentos]</a>
    <span class="k">def</span> <span class="nf">cargarDatosViaje</span><span class="p">(</span><span class="n">fila</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Método para cargar los datos de un viaje en los widgets de la interfaz gráfica.</span>

<span class="sd">                :param fila: Lista que contiene los datos del viaje actual [origen, destino, tarifa, km].</span>
<span class="sd">                :type fila: list</span>

<span class="sd">                Acciones:</span>
<span class="sd">                    - Imprime por consola los datos del viaje actual.</span>
<span class="sd">                    - Obtiene las localidades y provincias asociadas a los datos del viaje.</span>
<span class="sd">                    - Itera sobre los ComboBox y asigna las provincias y localidades a cada uno.</span>
<span class="sd">                    - Asigna el valor de los kilómetros al campo de texto correspondiente.</span>
<span class="sd">                    - Itera sobre los RadioButton y selecciona el RadioButton correspondiente a la tarifa del viaje.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Datos del viaje actual:&quot;</span><span class="p">,</span> <span class="n">fila</span><span class="p">)</span>

            <span class="n">localidades</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">fila</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">fila</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>
            <span class="n">provincias</span> <span class="o">=</span> <span class="p">[</span><span class="n">Viajes</span><span class="o">.</span><span class="n">obtenerNombreProvincia</span><span class="p">(</span><span class="n">Viajes</span><span class="o">.</span><span class="n">obtenerIdProvincia</span><span class="p">(</span><span class="n">localidad</span><span class="p">))</span> <span class="k">for</span> <span class="n">localidad</span> <span class="ow">in</span>
                          <span class="n">localidades</span><span class="p">]</span>
            <span class="n">tarifa</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fila</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">kms</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fila</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">idViaje</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fila</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">cmbProv</span><span class="p">,</span> <span class="n">cmbLoc</span><span class="p">,</span> <span class="n">provincia</span><span class="p">,</span> <span class="n">localidad</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbOrigenProvFac</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbDestinoProvFac</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbOrigenLocFac</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbDestinoLocFac</span><span class="p">],</span>
                    <span class="n">provincias</span><span class="p">,</span>
                    <span class="n">localidades</span>
            <span class="p">):</span>

                <span class="n">cmbProv</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">provincia</span><span class="p">)</span>
                <span class="n">cmbProv</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">provincia</span><span class="p">)</span>


                <span class="n">cmbLoc</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">localidad</span><span class="p">)</span>
                <span class="n">cmbLoc</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">localidad</span><span class="p">)</span>

            <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txt_kms</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">kms</span><span class="p">)</span>
            <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lbl_idViaje</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">idViaje</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">rbt</span><span class="p">,</span> <span class="n">tarifa_valor</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">rbtNacional</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">rbtProvincial</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">rbtLocal</span><span class="p">],</span>
                    <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">rbt</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">tarifa</span> <span class="o">==</span> <span class="n">tarifa_valor</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al cargar los datos de un viaje en cargarDatosViaje &quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>




    <span class="c1">#TODO METODO PARA CARGAR LOS DATOS DEL VIAJE PERO SIN FOR, ENTENDIBLE PERO MAS EXTENSO</span>

    <span class="c1"># def cargarDatosViaje(fila):</span>
    <span class="c1">#     try:</span>
    <span class="c1">#         print(&quot;Datos del viaje actual:&quot;, fila)</span>
    <span class="c1">#</span>
    <span class="c1">#         localidad_origen = str(fila[1])</span>
    <span class="c1">#         localidad_destino = str(fila[2])</span>
    <span class="c1">#</span>
    <span class="c1">#         id_provincia_origen = Viajes.obtenerIdProvincia(localidad_origen)</span>
    <span class="c1">#         id_provincia_destino = Viajes.obtenerIdProvincia(localidad_destino)</span>
    <span class="c1">#</span>
    <span class="c1">#         provincia_origen = Viajes.obtenerNombreProvincia(id_provincia_origen)</span>
    <span class="c1">#         provincia_destino = Viajes.obtenerNombreProvincia(id_provincia_destino)</span>
    <span class="c1">#</span>
    <span class="c1">#         var.ui.cmbOrigenProvFac.clear()</span>
    <span class="c1">#         var.ui.cmbOrigenProvFac.addItem(provincia_origen)</span>
    <span class="c1">#         var.ui.cmbOrigenProvFac.setCurrentText(provincia_origen)</span>
    <span class="c1">#</span>
    <span class="c1">#         var.ui.cmbDestinoProvFac.clear()</span>
    <span class="c1">#         var.ui.cmbDestinoProvFac.addItem(provincia_destino)</span>
    <span class="c1">#         var.ui.cmbDestinoProvFac.setCurrentText(provincia_destino)</span>
    <span class="c1">#</span>
    <span class="c1">#         var.ui.cmbOrigenLocFac.clear()</span>
    <span class="c1">#         var.ui.cmbOrigenLocFac.addItem(localidad_origen)</span>
    <span class="c1">#         var.ui.cmbOrigenLocFac.setCurrentText(localidad_origen)</span>
    <span class="c1">#</span>
    <span class="c1">#         var.ui.cmbDestinoLocFac.clear()</span>
    <span class="c1">#         var.ui.cmbDestinoLocFac.addItem(localidad_destino)</span>
    <span class="c1">#         var.ui.cmbDestinoLocFac.setCurrentText(localidad_destino)</span>
    <span class="c1">#</span>
    <span class="c1">#         kms = str(fila[4])</span>
    <span class="c1">#         var.ui.txt_kms.setText(kms)</span>
    <span class="c1">#</span>
    <span class="c1">#         tarifa = float(fila[3])</span>
    <span class="c1">#</span>
    <span class="c1">#         # Marcar el RadioButton según el valor de la tarifa</span>
    <span class="c1">#         if tarifa == 0.2:</span>
    <span class="c1">#             var.ui.rbtNacional.setChecked(True)</span>
    <span class="c1">#         elif tarifa == 0.4:</span>
    <span class="c1">#             var.ui.rbtProvincial.setChecked(True)</span>
    <span class="c1">#         elif tarifa == 0.8:</span>
    <span class="c1">#             var.ui.rbtLocal.setChecked(True)</span>
    <span class="c1">#</span>
    <span class="c1">#     except Exception as error:</span>
    <span class="c1">#         print(&quot;Error al cargar los datos de un viaje en cargarDatosViaje &quot;, error)</span>

<div class="viewcode-block" id="Viajes.obtenerIdProvincia">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.obtenerIdProvincia">[documentos]</a>
    <span class="k">def</span> <span class="nf">obtenerIdProvincia</span><span class="p">(</span><span class="n">localidad</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Método para obtener el ID de la provincia asociado a una localidad.</span>

<span class="sd">            :param localidad: Nombre de la localidad para la cual se desea obtener el ID de la provincia.</span>
<span class="sd">            :type localidad: str</span>
<span class="sd">            :return: El ID de la provincia asociado a la localidad.</span>
<span class="sd">            :rtype: int or None</span>

<span class="sd">            Acciones:</span>
<span class="sd">                - Prepara una consulta SQL para seleccionar el ID de la provincia de la tabla &#39;municipios&#39;</span>
<span class="sd">                  donde el nombre de la localidad sea igual al proporcionado.</span>
<span class="sd">                - Ejecuta la consulta y, si tiene éxito, obtiene el resultado y lo retorna como un entero.</span>
<span class="sd">                - Si no se encuentra un ID de provincia, imprime un mensaje indicando la falta de información y retorna None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT idprov FROM municipios WHERE municipio = :localidad&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:localidad&quot;</span><span class="p">,</span> <span class="n">localidad</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">resultado</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">resultado</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No se encontró un ID de provincia para la localidad </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">localidad</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al obtener el ID de la provincia: &quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Viajes.obtenerNombreProvincia">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.obtenerNombreProvincia">[documentos]</a>
    <span class="k">def</span> <span class="nf">obtenerNombreProvincia</span><span class="p">(</span><span class="n">id_provincia</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Método para obtener el nombre de la provincia asociado a un ID de provincia.</span>

<span class="sd">            :param id_provincia: ID de la provincia para el cual se desea obtener el nombre.</span>
<span class="sd">            :type id_provincia: int</span>
<span class="sd">            :return: El nombre de la provincia asociado al ID proporcionado.</span>
<span class="sd">            :rtype: str or None</span>

<span class="sd">            Acciones:</span>
<span class="sd">                - Prepara una consulta SQL para seleccionar el nombre de la provincia de la tabla &#39;provincias&#39;</span>
<span class="sd">                  donde el ID de la provincia sea igual al proporcionado.</span>
<span class="sd">                - Ejecuta la consulta y, si tiene éxito, obtiene el resultado y lo retorna como una cadena.</span>
<span class="sd">                - Si no se encuentra un nombre de provincia, retorna None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT provincia FROM provincias WHERE idprov = :id_provincia&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:id_provincia&quot;</span><span class="p">,</span> <span class="n">id_provincia</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span> <span class="ow">and</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al obtener el nombre de la provincia: &quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Viajes.borrarviaje">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.borrarviaje">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">borrarviaje</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Método estático para solicitar confirmación y borrar un viaje seleccionado.</span>

<span class="sd">        :param self: Referencia a la instancia de la clase.</span>
<span class="sd">        :type self: TuClase or None</span>

<span class="sd">        Acciones:</span>
<span class="sd">            - Muestra un cuadro de diálogo de advertencia preguntando al usuario si desea borrar el viaje.</span>
<span class="sd">            - Si el usuario elige &#39;Sí&#39;, obtiene la fila seleccionada en la tabla de viajes y prepara una consulta SQL para eliminar el viaje.</span>
<span class="sd">            - Ejecuta la consulta y actualiza la tabla de viajes llamando al método cargarTablaViajes de la clase Viajes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mbox</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">mbox</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Borrar&quot;</span><span class="p">)</span>
            <span class="n">mbox</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Icon</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
            <span class="n">mbox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;¿Desea Borrar el viaje?&quot;</span><span class="p">)</span>
            <span class="n">mbox</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>

            <span class="n">resultado</span> <span class="o">=</span> <span class="n">mbox</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">resultado</span> <span class="o">==</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()</span>

                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s1">&#39;delete from viajes where idviajes = :id&#39;</span><span class="p">)</span>

                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:id&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>

                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
                <span class="n">Viajes</span><span class="o">.</span><span class="n">cargarTablaViajes</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">resultado</span> <span class="o">==</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">No</span><span class="p">:</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error al borrar viaje&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>



    <span class="c1">#TODO METODO PARA BUSCAR UN VIAJE AL SELECCIONARLO EN LA TABLA</span>
<div class="viewcode-block" id="Viajes.buscarViajeTabla">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.buscarViajeTabla">[documentos]</a>
    <span class="k">def</span> <span class="nf">buscarViajeTabla</span><span class="p">(</span><span class="n">codigo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Método para buscar un viaje en la tabla de viajes al seleccionarlo.</span>

<span class="sd">            :param codigo: Código del viaje que se desea buscar en la tabla.</span>
<span class="sd">            :type codigo: int or str</span>

<span class="sd">            Acciones:</span>
<span class="sd">                - Itera sobre las filas de la tabla de viajes.</span>
<span class="sd">                - Compara el valor de la primera celda (columna de códigos) con el código proporcionado.</span>
<span class="sd">                - Si encuentra una coincidencia, selecciona la fila correspondiente y realiza un desplazamiento para mostrarla.</span>
<span class="sd">                - Imprime un mensaje indicando la fila encontrada.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tabla</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tabViajes</span>
            <span class="k">for</span> <span class="n">fila</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tabla</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">tabla</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">fila</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">valorCelda</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">valorCelda</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">codigo</span><span class="p">):</span>
                    <span class="n">tabla</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
                    <span class="n">tabla</span><span class="o">.</span><span class="n">scrollToItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fila encontrada:&quot;</span><span class="p">,</span> <span class="n">fila</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No se ha podido seleccionar al cliente en la tabla&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>



<div class="viewcode-block" id="Viajes.modificarViaje">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.modificarViaje">[documentos]</a>
    <span class="k">def</span> <span class="nf">modificarViaje</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Método para modificar un viaje con los datos proporcionados por el usuario.</span>

<span class="sd">        Acciones:</span>
<span class="sd">            - Obtiene los valores de origen, destino y kilómetros desde los ComboBox y el campo de texto correspondiente.</span>
<span class="sd">            - Llama al método modificarViajeConexion de la clase Viajes para realizar la modificación en la base de datos.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tarifas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]</span>

            <span class="n">viajes</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lbl_idViaje</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbOrigenProvFac</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbDestinoProvFac</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbOrigenLocFac</span><span class="p">,</span>
                      <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">cmbDestinoLocFac</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txt_kms</span><span class="p">]</span>
            <span class="n">modificarViaje</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>  <span class="c1"># Ajusta el rango para incluir todos los elementos</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">viajes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">):</span>
                    <span class="n">modificarViaje</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">viajes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">modificarViaje</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">viajes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">modificarViaje</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">modificarViaje</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">modificarViaje</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">modificarViaje</span><span class="p">[</span><span class="mi">3</span><span class="p">]):</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">rbtLocal</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">modificarViaje</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tarifas</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">rbtProvincial</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">modificarViaje</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tarifas</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">var</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">rbtNacional</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>





            <span class="n">Viajes</span><span class="o">.</span><span class="n">modificarViajeConexion</span><span class="p">(</span><span class="n">modificarViaje</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al modificar el viaje&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="Viajes.modificarViajeConexion">
<a class="viewcode-back" href="../src/viajes.html#viajes.Viajes.modificarViajeConexion">[documentos]</a>
    <span class="k">def</span> <span class="nf">modificarViajeConexion</span><span class="p">(</span><span class="n">modificarViaje</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Función para modificar un viaje en la base de datos con los datos proporcionados.</span>

<span class="sd">            Parámetros:</span>
<span class="sd">                - modificarViaje: Lista que contiene los datos del viaje a modificar [idviajes, origen, destino, tarifa, km].</span>
<span class="sd">                  Se espera que idviajes sea una cadena y los demás elementos sean cadenas o flotantes convertidos a cadenas.</span>

<span class="sd">            Acciones:</span>
<span class="sd">                - Imprime por consola los datos del viaje a modificar.</span>
<span class="sd">                - Prepara una consulta SQL para actualizar la información del viaje en la tabla &#39;viajes&#39; usando los valores proporcionados.</span>
<span class="sd">                - Ejecuta la consulta y muestra un mensaje de aviso o advertencia en función del resultado.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MODIFICAR VIAJE -&gt; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">modificarViaje</span><span class="p">))</span>

            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s1">&#39;UPDATE viajes SET origen = :origen, destino = :destino, tarifa = :tarifa, km = :km where idviajes = :idviajes&#39;</span><span class="p">)</span>

            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:idviajes&#39;</span><span class="p">,</span> <span class="n">modificarViaje</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:origen&#39;</span><span class="p">,</span> <span class="n">modificarViaje</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:destino&#39;</span><span class="p">,</span> <span class="n">modificarViaje</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:tarifa&#39;</span><span class="p">,</span> <span class="n">modificarViaje</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s1">&#39;:km&#39;</span><span class="p">,</span> <span class="n">modificarViaje</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>  <span class="c1"># Cambiado a exec_() para reflejar la ejecución de la consulta</span>
                <span class="n">mbox</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Aviso&#39;</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Icon</span><span class="o">.</span><span class="n">Information</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Viaje modificado&#39;</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
                <span class="n">Viajes</span><span class="o">.</span><span class="n">cargarTablaViajes</span><span class="p">(</span><span class="n">modificarViaje</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mbox</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Aviso&#39;</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Icon</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lastError</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error al modificar el viaje en conexion&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>
</div>
















</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Índice de Módulos Python"
             >módulos</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">documentación de VieraFernandez2324 - v.0.0.1</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Código de módulo</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">viajes</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Elias.
      Creado usando <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>